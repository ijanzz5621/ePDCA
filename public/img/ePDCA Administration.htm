
<!-- saved from url=(0032)http://localhost:8080/admin/user -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <title>ePDCA Administration</title>

        <link rel="stylesheet" href="./ePDCA Administration_files/bootstrap.min.css">
        <link rel="stylesheet" href="./ePDCA Administration_files/bootstrap-theme.min.css">
        <link rel="stylesheet" href="./ePDCA Administration_files/jquery-ui.css">
        <link rel="stylesheet" href="./ePDCA Administration_files/site.css">
        <link rel="stylesheet" href="./ePDCA Administration_files/jquery.dynatable.css">

        <script src="./ePDCA Administration_files/jquery-3.2.1.min.js"></script>
        <script src="./ePDCA Administration_files/bootstrap.min.js"></script>  
        <script src="./ePDCA Administration_files/jquery-ui.js"></script>
        
        <script src="./ePDCA Administration_files/site.js"></script>
        <script src="./ePDCA Administration_files/jquery.dynatable.js"></script>

    </head>

    <body>

        <div class="navbar navbar-inverse navbar-fixed-top">
            <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="http://localhost:8080/admin/user#">ePDCA Administration</a>
            </div>
            <div class="collapse navbar-collapse">
            <ul class="nav navbar-nav">
                <!--<li class="active"><a href="#">Home</a></li>
                <li><a href="#about">About</a></li>
                <li><a href="#contact">Contact</a></li>-->
            </ul>
            </div><!--/.nav-collapse -->
        </div><!--/.navbar -->

        <div class="row-offcanvas row-offcanvas-left">
        <div id="sidebar" class="sidebar-offcanvas">
            <div id="nav" class="col-md-12" style="padding-top:30px;">
                <ul class="nav nav-pills nav-stacked">
                <li><a href="http://localhost:8080/admin/company">Company</a></li>
                <li><a href="http://localhost:8080/admin/department">Department</a></li>
                <li class="active"><a href="http://localhost:8080/admin/user">User</a></li>
                <li><a href="http://localhost:8080/admin/license">License</a></li>
                <li><a href="http://localhost:8080/admin/packages">Package</a></li>
                </ul>
            </div>
        </div>
        <div id="main">
            <div class="col-md-12">
                <p class="visible-xs">
                    <button type="button" class="btn btn-primary btn-xs" data-toggle="offcanvas"><i class="glyphicon glyphicon-chevron-left"></i></button>
                </p>
                <h3>User</h3>

<div id="icon-list">
  <img src="./ePDCA Administration_files/add-icon.png" id="icon-add-user" width="32px" class="icon-maint" onclick="iconTrigger(this);" title="Add new user">
</div>

<div id="dynatable-processing-userList" class="dynatable-processing" style="position: absolute; top: 129px; left: 15px; width: 795px; height: 36px; display: none;"><span style="position: relative; top: 10px; left: 363px;">Processing...</span></div><span id="dynatable-search-userList" class="dynatable-search">Search: <input type="search" id="dynatable-query-search-userList" data-dynatable-query="search"></span><span class="dynatable-per-page"><span class="dynatable-per-page-label">Show: </span><select id="dynatable-per-page-userList" class="dynatable-per-page-select"><option value="10" selected="selected">10</option><option value="20">20</option><option value="50">50</option><option value="100">100</option></select></span><table id="userList" class="table table-bordered table-responsive table-striped dynatable">
  <thead>
    <tr>
      <th data-dynatable-column="Email" class="dynatable-head"><a class="dynatable-sort-header" href="http://localhost:8080/admin/user#">Email</a></th>
      <th data-dynatable-column="UserCode" class="dynatable-head"><a class="dynatable-sort-header" href="http://localhost:8080/admin/user#">Employee Code</a></th>
      <th data-dynatable-column="Username" class="dynatable-head"><a class="dynatable-sort-header" href="http://localhost:8080/admin/user#">Name</a></th>
      <th data-dynatable-column="Gender" class="dynatable-head"><a class="dynatable-sort-header" href="http://localhost:8080/admin/user#">Gender</a></th>
      <th data-dynatable-column="SupervisorId" class="dynatable-head"><a class="dynatable-sort-header" href="http://localhost:8080/admin/user#">Supervisor</a></th>
      <th data-dynatable-column="CompanyCode" class="dynatable-head"><a class="dynatable-sort-header" href="http://localhost:8080/admin/user#">Company</a></th>
      <th data-dynatable-column="DepartmentCode" class="dynatable-head"><a class="dynatable-sort-header" href="http://localhost:8080/admin/user#">Department</a></th>

    </tr>
  </thead>
  <tbody>
  <tr><td style="text-align: left;"><a href="http://localhost:8080/admin/user-details?userGuid=83590eb2-8580-11e7-8b84-b1878f386c76">azhar@sdi.com</a></td><td style="text-align: left;">00001</td><td style="text-align: left;">Mr. Azhar</td><td style="text-align: left;">M</td><td style="text-align: left;"></td><td style="text-align: left;">SDI</td><td style="text-align: left;">PDCA</td></tr><tr><td style="text-align: left;"><a href="http://localhost:8080/admin/user-details?userGuid=edaf5776-85a3-11e7-8b84-b1878f386c76">diana@sdi.com</a></td><td style="text-align: left;">00002</td><td style="text-align: left;">Diana</td><td style="text-align: left;">F</td><td style="text-align: left;">azhar@sdi.com</td><td style="text-align: left;">SDI</td><td style="text-align: left;">PDCA</td></tr><tr><td style="text-align: left;"><a href="http://localhost:8080/admin/user-details?userGuid=12345">sharizan_81@yahoo.com</a></td><td style="text-align: left;">14444</td><td style="text-align: left;">Sharizan Redzuan</td><td style="text-align: left;">M</td><td style="text-align: left;">azhar@sdi.com</td><td style="text-align: left;">SDI</td><td style="text-align: left;">PDCA</td></tr></tbody>
</table><ul id="dynatable-pagination-links-userList" class="dynatable-pagination-links"><li><span>Pages: </span></li><li class="dynatable-disabled-page"><a data-dynatable-page="0" class="dynatable-page-link dynatable-page-prev dynatable-disabled-page">Previous</a></li><li class="dynatable-active-page"><a data-dynatable-page="1" class="dynatable-page-link dynatable-active-page">1</a></li><li class="dynatable-disabled-page"><a data-dynatable-page="2" class="dynatable-page-link dynatable-page-next dynatable-disabled-page">Next</a></li></ul><span id="dynatable-record-count-userList" class="dynatable-record-count">Showing 3 of 3 records</span>

<script type="text/javascript">
  var table = $('#userList')
    .dynatable({
      writers: {
        'Email': function(record){
          return "<a href='/admin/user-details?userGuid=" + record.RecGuid + "'>" + record.Email + "</a>";
        }
      } 
    })
    .on('dblclick', 'tr', function (e) {
      var selectedData = table.settings.dataset.originalRecords[e.currentTarget.rowIndex - 1];
      callModal(selectedData);
    })
    .data('dynatable');

  $(document).ready(function () {

    $.ajax({
      url: "/api/users", success: function (result) {
        bindDataTable(result);
      }
    });

    //load company list
    loadCompanyList();

    //load department list

    //on change
    $('#ddlCompany').on('change', function (e) {
      //alert($('#ddlCompany').val() + ' has been selected!');
      loadDepartmentByCompany($('#ddlCompany').val());
    });
    $('#ddlDepartment').on('change', function (e) {
      loadUsersByDepartmentAndCompany($('#ddlCompany').val(), $('#ddlDepartment').val());
    });

  });

  $(document).on('change', "input[name='rbGender']:radio", function () {
    //alert($(this).val());
    $('#lblGenderM')
      .removeClass('active')
      .removeClass('btn-success')
      .addClass('btn-default');
    $('#lblGenderF')
      .removeClass('active')
      .removeClass('btn-success')
      .addClass('btn-default');

    $(this).closest('label').removeClass('btn-default').addClass('btn-success').addClass('active');
  });

  function resetForm() {
    $('#txtEmail').removeAttr("readonly");
    $('#txtEmail').val("");
    $('#txtUserCode').val("");
    $('#txtUsername').val("");
    $('#lblGenderM')
      .removeClass('active')
      .removeClass('btn-success')
      .addClass('btn-default');
    $('#lblGenderF')
      .removeClass('active')
      .removeClass('btn-success')
      .addClass('btn-default');

    $('#ddlCompany').val("");
    $('#ddlDepartment').val("");
    $('#ddlSupervisor').val("");
  }

  function loadUsersByDepartmentAndCompany(companyCode, departmentCode, dataSupervisor) {
    if ($('#ddlSupervisor option').length > 1) {
      $('#ddlSupervisor > option').slice(1, $('#ddlSupervisor option').length).remove();
    }

    $.ajax({
      url: "/api/usersByCompanyAndDepartment/?companyCode=" + companyCode + "&departmentCode=" + departmentCode, success: function (result) {
        $.each(result, function (idx, val) {
          $('#ddlSupervisor').append('<option value=\'' + val.Email + '\'>' + val.Username + '</option>');
        });

        if (dataSupervisor != null) {
          $('#ddlSupervisor').val(dataSupervisor);
        }

      }
    });
  }

  function loadCompanyList() {

    //alert($('#ddlCompany option').length);
    //alert($('#ddlCompany').text());

    if ($('#ddlCompany option').length > 1) {
      $('#ddlCompany > option').slice(1, $('#ddlCompany option').length).remove();
    }

    $.ajax({
      url: "/api/companies", success: function (result) {

        $.each(result, function (idx, val) {
          $('#ddlCompany').append('<option value=\'' + val.CompanyCode + '\'>' + val.CompanyName + '</option>');
        })
      }
    });
  }

  function loadDepartmentByCompany(companyCode, dataDepartmentCode) {

    if ($('#ddlDepartment option').length > 1) {
      $('#ddlDepartment > option').slice(1, $('#ddlDepartment option').length).remove();
    }

    $.ajax({
      url: "/api/departmentsByCompany/" + companyCode, success: function (result) {

        $.each(result, function (idx, val) {
          $('#ddlDepartment').append('<option value=\'' + val.DepartmentCode + '\'>' + val.DepartmentName + '</option>');
        })

        if (dataDepartmentCode != null) {
          $('#ddlDepartment').val(dataDepartmentCode);
        }

      }
    });

  }

  function bindDataTable(data) {
    table.settings.dataset.originalRecords = data;
    table.process();

  };

  function iconTrigger(obj) {
    var selectedIcon = $(obj).attr('id');
    if (selectedIcon === "icon-add-user") {
      resetForm();
      $('#modal-add-user').modal();
    }
  }

  function callModal(data) {

    $('#txtEmail').val(data.Email);
    $('#txtEmail').attr("readonly", "readonly");
    //populate the details into the popup form
    $('#ddlCompany').val(data.CompanyCode);
    loadDepartmentByCompany(data.CompanyCode, data.DepartmentCode);
    loadUsersByDepartmentAndCompany(data.CompanyCode, data.DepartmentCode, data.SupervisorId);
    $('#txtUserCode').val(data.UserCode);
    $('#txtUsername').val(data.Username);

    $("input[name=rbGender][value=" + data.Gender + "]").prop("checked", true);
    $('#lblGender' + data.Gender).removeClass('btn-default').addClass('btn-success').addClass('active');


    $('#modal-add-user').modal();
  }

  function validateForm() {

    if (!$("input[name='rbGender']:checked").val()) {
      alert("Please select Gender!");
      return false;
    }

    return true;

  }

  $('#btnSubmit').on('click', function (e) {
    e.preventDefault();
    alert('submit');
    
    //return false;
    if (validateForm()) {
      //alert("form validation successful!");
      //$('#formUser').submit();
    } else {
      //alert("form validation failed!");
    }

  });

</script>

<form id="formUser" method="post" action="http://localhost:8080/admin/user/add-edit-user">

    <div id="modal-add-user" class="modal fade" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
                    <h4 class="modal-title">Add / Edit User</h4>
                </div>
                <div class="modal-body row">

                    <div class="form-group col-md-6">
                        <label for="txtEmail">Email address</label>
                        <input type="email" class="form-control" name="txtEmail" id="txtEmail" placeholder="Email" required="required">
                    </div>

                    <div class="form-group col-md-6">
                        <label for="txtUserCode">User Code</label>
                        <input type="text" class="form-control" name="txtUserCode" id="txtUserCode" placeholder="User Code">
                    </div>

                    <div class="form-group col-md-6">
                        <label for="txtUsername">Username</label>
                        <input type="text" class="form-control" name="txtUsername" id="txtUsername" placeholder="Username" required="required">
                    </div>

                    <div class="form-group col-md-6">
                        <label for="ddlCompany">Company</label>
                        <select class="form-control" data-attr="dropdown" aria-placeholder="Company" id="ddlCompany" name="ddlCompany" required="required">
                            <option value="">-- Please Select --</option>
                            
                        <option value="Exabytes">Exabytes Hosting Malaysia</option><option value="Firstsolar">Firstsolar Malaysia</option><option value="Hoya">Hoya Malaysia</option><option value="Lumileds">Lumileds Malaysia Limited</option><option value="Microchip">Microchip Operation Malaysia</option><option value="SDI">Smart Digital Network</option></select>
                    </div>
                    <div class="form-group col-md-6">
                        <label for="ddlDepartment">Department</label>
                        <select class="form-control" aria-placeholder="Company" id="ddlDepartment" name="ddlDepartment" required="required">
                            <option value="">-- Please Select --</option>
                        </select>
                    </div>

                    <div class="form-group col-md-6">
                        <label for="ddlSupervisor">Supervisor</label>
                        <select class="form-control" aria-placeholder="Supervisor" id="ddlSupervisor" name="ddlSupervisor">
                            <option value="">-- Please Select --</option>
                        </select>
                    </div>

                    <div class="form-group col-md-6">
                        <label for="radioGender">Gender</label>
                        <br>
                        <div id="radioGender" class="btn-group" data-toggle="buttons">
                            <label id="lblGenderM" class="btn btn-default checked">
                                    <input type="radio" name="rbGender" id="rbGenderMale" value="M"> Male
                                </label>
                            <label id="lblGenderF" class="btn btn-default">
                                    <input type="radio" name="rbGender" id="rbGenderFemale" value="F"> Female
                                </label>
                        </div>
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <input type="submit" id="btnSubmit" class="btn btn-primary" value="Save Changes">
                </div>
            </div>

        </div>

    </div>


</form>
            </div>
        </div>
        </div><!--/row-offcanvas -->

        <script>
            $(document).ready(function() {

                var pgurl = window.location.pathname;
                $("#nav ul li a").each(function () {
                    
                    //alert(pgurl);
                    //if ($(this).attr("href") == pgurl || $(this).attr("href") == '')
                    if (pgurl === '/' && $(this).attr("href") === '/')
                        $(this).parent().addClass("active");
                    else if (pgurl.indexOf($(this).attr("href")) >= 0 && $(this).attr("href") !== '/')
                        //$(this).addClass("active");
                        $(this).parent().addClass("active");
                    else 
                        $(this).parent().removeClass("active");

                        //alert(pgurl.indexOf($(this).attr("href")));

                    //alert($(this).attr("href") + " - " + pgurl);
                });

                $('[data-toggle=offcanvas]').click(function() {
                    $('.row-offcanvas').toggleClass('active');
                });
            });

            $(function(){

                $(document).tooltip({
                    position: {
                        my: "center bottom-20",
                        at: "center top",
                        using: function (position, feedback) {
                            $(this).css(position);
                            $("<div>")
                                .addClass("arrow")
                                .addClass(feedback.vertical)
                                .addClass(feedback.horizontal)
                                .appendTo(this);
                        }
                    }
                });

            });

        </script>


    

<div role="log" aria-live="assertive" aria-relevant="additions" class="ui-helper-hidden-accessible"></div></body></html>