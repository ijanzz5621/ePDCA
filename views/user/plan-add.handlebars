<link rel="stylesheet" href="/css/multi-step-form.css"/>
<style>
	#userList {
		float: left;
		width: 100%;
		height: 18em;
		background: #fbfbfb;
		border: 1px dashed #000;
		overflow: scroll;
	}

	.userList.custom-state-active {
		background: #eee;
	}

	.userList li {
		float: left;
		width: 96px;
		padding: 0.4em;
		margin: 0 0.4em 0.4em 0;
		text-align: center;
	}

	.userList li h5 {
		margin: 0 0 0.4em;
		cursor: move;
	}

	.userList li a {
		float: right;
	}

	.userList li a.ui-icon-zoomin {
		float: left;
	}

	.userList li img {
		width: 100%;
		cursor: move;
	}

	#teamLead {
		/*float: right;*/
		width: 105px;
		height: 9em;
		padding: 1%;
		background: #fbfbfb;
		border: 1px dashed #000;
		margin: 0 auto;
		overflow: hidden;
	}

	#teamLead h4 {
		line-height: 16px;
		margin: 0 0 0.4em;
	}

	#teamLead h4 .ui-icon {
		float: left;
	}

	#teamLead .userList h5 {
		/*display: none;*/
	}

	#teamMember {
		float: right;
		/*width: 32%;*/
		height: 18em;
		padding: 1%;
		background: #fbfbfb;
		border: 1px dashed #000;
		width:100%;
		overflow: scroll;
	}

	#teamMember h4 {
		line-height: 16px;
		margin: 0 0 0.4em;
	}

	#teamMember h4 .ui-icon {
		float: left;
	}

	#teamMember .userList h5 {
		/*display: none;*/
	}

	h4{
		margin-top:0 !important;
	}
</style>

<h3>Create new plan</h3>

<!-- multistep form -->
<form id="msform" method="post" action="/user/plan-add">
	<!-- progressbar -->
	<ul id="progressbar">
		<li class="active">Problem Statement</li>
		<li>Team</li>
		<li>Risk Level</li>
        <li>Financial Impact</li>
        <li>Standard</li>
	</ul>
	<!-- fieldsets -->
	<fieldset>
		<h2 class="fs-title">Define your problem here</h2>
		<h3 class="fs-subtitle">Write what is the problem that you faced in your working area.</h3>
		<!--<input type="text" name="email" placeholder="Email" />
		<input type="password" name="pass" placeholder="Password" />
		<input type="password" name="cpass" placeholder="Confirm Password" />-->

        <textarea rows="5" cols="200" id="txtProblemStatement" name="txtProblemStatement"></textarea>

		<input type="button" name="next" class="next action-button" value="Next" />
	</fieldset>
	<fieldset>
		<h2 class="fs-title">Team</h2>
		<h3 class="fs-subtitle">Configure your team lead and team members</h3>
	
			<div class="ui-widget ui-helper-clearfix">

				<div class="row">

					<div class="col-md-5">

						<ul id="userList" class="userList ui-helper-reset ui-helper-clearfix drop-target">
							<h4 class="ui-widget-header"><span class="ui-icon ui-icon-userList">userList</span> Employee List</h4>
							<li class="ui-widget-content ui-corner-tr" value="00001-azhar">
								<h5 class="ui-widget-header">Kassim</h5>
								<img src="/img/user-icon-128.png" alt="user image" width="96" height="72">
								<a href="/img/user-icon-256.png" title="large user image" class="ui-icon ui-icon-zoomin">View larger</a>
								<a href="link/to/teamLead/script/when/we/have/js/off" title="Delete this image" class="ui-icon ui-icon-teamLead">Delete image</a>
							</li>
							<li class="ui-widget-content ui-corner-tr" value="00002-diana">
								<h5 class="ui-widget-header">Abu</h5>
								<img src="/img/user-icon-128.png" alt="user image" width="96" height="72">
								<a href="i/img/user-icon-256.png" title="large user image" class="ui-icon ui-icon-zoomin">View larger</a>
								<a href="link/to/teamLead/script/when/we/have/js/off" title="Delete this image" class="ui-icon ui-icon-teamLead">Delete image</a>
							</li>
							<li class="ui-widget-content ui-corner-tr" value="00003-sharizan">
								<h5 class="ui-widget-header">Aminah</h5>
								<img src="/img/user-icon-128.png" alt="user image" width="96" height="72">
								<a href="/img/user-icon-256.png" title="large user image" class="ui-icon ui-icon-zoomin">View larger</a>
								<a href="link/to/teamLead/script/when/we/have/js/off" title="Delete this image" class="ui-icon ui-icon-teamLead">Delete image</a>
							</li>		
						</ul>

					</div>
					<div class="col-md-2">

						<div id="teamLead" class="ui-widget-content ui-state-default drop-target">
							<h4 class="ui-widget-header"><span class="ui-icon ui-icon-teamLead">teamLead</span> Team Lead</h4>
						</div>

					</div>
					<div class="col-md-5">

						<div id="teamMember" class="ui-widget-content ui-state-default drop-target">
							<h4 class="ui-widget-header"><span class="ui-icon ui-icon-teamMember">teamLead</span> Team Members</h4>
						</div>

					</div>
				</div>

			</div>

		<input type="button" name="previous" class="previous action-button" value="Previous" />
		<input type="button" name="next" class="next action-button" value="Next" />
	</fieldset>
    <fieldset>
		<h2 class="fs-title">Risk Level</h2>
		<h3 class="fs-subtitle">What do you think of the risk level of the problem?</h3>
		
		<div class="funkyradio">
			<div class="funkyradio-success">
				<input type="radio" name="radioRiskLevel" value="low" id="risk-level-low" />
				<label for="risk-level-low">Low</label>
			</div>
			<div class="funkyradio-success">
				<input type="radio" name="radioRiskLevel" value="medium" id="risk-level-medium" />
				<label for="risk-level-medium">Medium</label>
			</div>
			<div class="funkyradio-success">
				<input type="radio" name="radioRiskLevel" value="high" id="risk-level-high" />
				<label for="risk-level-high">High</label>
			</div>			
		</div>
		     
		<input type="button" name="previous" class="previous action-button" value="Previous" />
		<input type="button" name="next" class="next action-button" value="Next" />
	</fieldset>
    <fieldset>
		<h2 class="fs-title">Financial Impact</h2>
		<h3 class="fs-subtitle">Please enter estimated amount for the impact</h3>
		

        <input type="text" name="txtFinancialImpact" placeholder="Amount (RM)" style="width:210px;" />
        <br/>
        
		<input type="button" name="previous" class="previous action-button" value="Previous" />
		<input type="button" name="next" class="next action-button" value="Next" />
	</fieldset>
	<fieldset>
		<h2 class="fs-title">Standard</h2>
		<h3 class="fs-subtitle">Was the standard being followed?</h3>
		<!--<input type="text" name="fname" placeholder="First Name" />
		<input type="text" name="lname" placeholder="Last Name" />
		<input type="text" name="phone" placeholder="Phone" />
		<textarea name="address" placeholder="Address"></textarea>-->      
		<div class="funkyradio">
			<div class="funkyradio-success">
				<input type="radio" name="radioFollowStandard" value="Yes" id="follow-std-yes" />
				<label for="follow-std-yes">Yes</label>
			</div>
			<div class="funkyradio-success">
				<input type="radio" name="radioFollowStandard" value="No" id="follow-std-no" />
				<label for="follow-std-no">No</label>
			</div>		
		</div>

		<input type="hidden" id="hidTeamLead" name="hidTeamLead" />
		<input type="hidden" id="hidTeamMembers" name="hidTeamMembers" />
		
		<input type="button" name="previous" class="previous action-button" value="Previous" />
		<input id="submit" type="submit" name="submit" class="submit action-button" value="Submit" />
	</fieldset>
</form>

<!-- jQuery easing plugin -->
<script src="/js/jquery.easing.min.js" type="text/javascript"></script>
<script src="/js/multi-step-form.js" type="text/javascript"></script>
<script src="/js/jquery.ui.touch-punch.min.js" type="text/javascript"></script>

<script>
	$(function () {

		var sourceDragElement;

		// There's the userList and the teamLead
		var $userList = $("#userList"),
			$teamLead = $("#teamLead"),
			$teamMember = $("#teamMember");

		// Let the userList items be draggable
		$("li", $userList).draggable({
			cancel: "a.ui-icon", // clicking an icon won't initiate dragging
			revert: "invalid", // when not dropped, the item will revert back to its initial position
			/*revert: function(dropped){
				//only allow 1 team lead
				if ($('#teamLead ul li').length > 1){
					alert('Only 1 team lead allow');
					return true;
				}
				return false;
			},*/
			start: function (event, ui) {
				//alert()
				sourceDragElement = $userList.attr('id');
				if ($('#teamLead ul li').length === 0){
					$teamLead.droppable( "option", "disabled", false );
				} else {
					$teamLead.droppable( "option", "disabled", true );
				}
			},
			containment: "document",
			helper: "clone",
			cursor: "move",
			zIndex: 99999
		});

		// Let the teamLead be droppable, accepting the userList items
		$teamLead.droppable({
			accept: ".drop-target > li",
			classes: {
				"ui-droppable-active": "ui-state-highlight"
			},
			drop: function (event, ui) {
				deleteImage(ui.draggable, $teamLead);
				ui.draggable.position({
						my: "center",
						at: "center",
						/*of: $this,
						using: function (pos) {
							$(this).animate(pos, 200, "linear");
						}*/
					});
			},
			zIndex: 99999
		});
		$teamMember.droppable({
			accept: ".drop-target > li",
			classes: {
				"ui-droppable-active": "ui-state-highlight"
			},
			drop: function (event, ui) {
				deleteImage(ui.draggable, $teamMember);
			},
			zIndex: 99999
		});

		// Let the userList be droppable as well, accepting items from the teamLead
		$userList.droppable({
			accept: ".drop-target li",
			classes: {
				"ui-droppable-active": "custom-state-active"
			},
			drop: function (event, ui) {
				recycleImage(ui.draggable);
			}
		});

		// Image deletion function
		var recycle_icon = "<a href='link/to/recycle/script/when/we/have/js/off' title='Recycle this image' class='ui-icon ui-icon-refresh'>Recycle image</a>";
		function deleteImage($item, $target) {
			$item.fadeOut(function () {
				var $list = $("ul", $target).length ?
					$("ul", $target) :
					$("<ul class='userList ui-helper-reset'/>").appendTo($target);

				//$item.find("a.ui-icon-teamLead").remove();
				$item.append(recycle_icon).appendTo($list).fadeIn(function () {
					$item
					//.animate({ width: "48px" })
					//.find("img")
					//.animate({ height: "36px" });
				});			
			});
		};

		// Image recycle function
		var teamLead_icon = "<a href='link/to/teamLead/script/when/we/have/js/off' title='Delete this image' class='ui-icon ui-icon-teamLead'>Delete image</a>";
		function recycleImage($item) {
			$item.fadeOut(function () {
				$item
					.find("a.ui-icon-refresh")
					.remove()
					.end()
					.css("width", "96px")
					.append(teamLead_icon)
					.find("img")
					.css("height", "72px")
					.end()
					.appendTo($userList)
					.fadeIn();
			});
		};

		// Image preview function, demonstrating the ui.dialog used as a modal window
		function viewLargerImage($link) {
			var src = $link.attr("href"),
				title = $link.siblings("img").attr("alt"),
				$modal = $("img[src$='" + src + "']");

			if ($modal.length) {
				$modal.dialog("open");
			} else {
				var img = $("<img alt='" + title + "' width='384' height='288' style='display: none; padding: 8px;' />")
					.attr("src", src).appendTo("body");
				setTimeout(function () {
					img.dialog({
						title: title,
						width: 400,
						modal: true
					});
				}, 1);
			}
		};

		// Resolve the icons behavior with event delegation
		$("ul.userList > li").on("click", function (event) {
			var $item = $(this),
				$target = $(event.target);

			if ($target.is("a.ui-icon-teamLead")) {
				deleteImage($item);
			} else if ($target.is("a.ui-icon-zoomin")) {
				viewLargerImage($target);
			} else if ($target.is("a.ui-icon-refresh")) {
				recycleImage($item);
			}

			return false;
		});

		$('#submit').on('click', function (e) {
			//e.preventDefault();
			//set team lead
			var teamLead = { id: '12345', name: 'sharizan' }
			$('#hidTeamLead').val(JSON.stringify(teamLead));

			//set team members
			var teamMembers = [];
			//teamMembers.push({id: '23456', name: 'azhar'});
			//teamMembers.push({id: '34567', name: 'diana'});
			$('#teamMember ul li').each(function(index){
				//alert('No: ' + index + ', name/id: ' + $(this).attr('value'));
				var splitVal = $(this).attr('value').split("-");
				teamMembers.push({id: splitVal[0], name: splitVal[1]});
			})
			$('#hidTeamMembers').val(JSON.stringify(teamMembers));

			//proceed with submission
			$('#msform').submit();
		});
	});

</script>